<!DOCTYPE html>
<html lang="{{ get_locale() }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ _('OCBC - Banking made easy') }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Open+Sans:wght@400;600;700&display=swap');
        body { font-family: 'Open Sans', sans-serif; }
        .font-inter { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-white">

    <div class="bg-gradient-to-r from-slate-600 to-slate-500 text-white text-sm py-3 px-4 flex justify-center items-start gap-3">
        <div class="bg-white text-slate-600 rounded text-xs font-bold px-1 mt-1">!</div>
        <div class="max-w-5xl">
            <span class="font-bold block mb-1">{{ _('Watch out for scam callers impersonating OCBC staff') }}</span>
            <p class="opacity-90 text-xs leading-relaxed">
                {{ _('Are you getting calls from unknown numbers? If a caller claims to be from OCBC and says they are connecting you to the police, hang up. Banks do not operate this way.') }}
                <a href="#" class="underline ml-1">{{ _('Learn more.') }}</a>
            </p>
        </div>
    </div>

    <header class="bg-white py-6 px-4 md:px-12 flex justify-between items-center max-w-7xl mx-auto w-full relative z-50">
        <div class="flex items-center gap-12">
            <div class="text-red-600 font-inter font-bold text-4xl tracking-tighter flex flex-col leading-none">
            <img src="/static/OCBC.jpg" width="150" alt="Logo">
                <span class="text-xs text-gray-400 font-normal mt-1 tracking-normal">{{ _('Banking made easy') }}</span>
            </div>

            <nav class="hidden md:flex gap-8 font-bold text-lg text-gray-800 font-inter">
                <a href="#" class="flex items-center gap-2 hover:text-red-600">
                    <i data-lucide="home" class="w-5 h-5"></i> {{ _('Personal') }}
                </a>
                <a href="#" class="flex items-center gap-2 hover:text-red-600">
                    <i data-lucide="briefcase" class="w-5 h-5"></i> {{ _('Business') }}
                </a>
                <a href="#" class="flex items-center gap-2 hover:text-red-600">
                    <i data-lucide="credit-card" class="w-5 h-5"></i> {{ _('Card Services') }}
                </a>
            </nav>
        </div>

        <div class="flex items-center gap-6 font-inter">

    <div class="relative group cursor-pointer py-2"> <div class="flex items-center gap-1 font-bold text-xl text-gray-800">
            {{ current_language|upper }}
            <i data-lucide="chevron-down" class="w-4 h-4 transition-transform group-hover:rotate-180"></i>
        </div>

        <div class="hidden group-hover:block absolute top-full right-0 pt-2 w-24 z-50">
            <div class="bg-white shadow-xl border border-gray-100 rounded-lg overflow-hidden">
                <a href="{{ url_for('set_language', lang_code='en') }}" class="block px-4 py-2 hover:bg-gray-50 hover:text-red-600 text-sm font-bold {{ 'text-red-600 bg-red-50' if current_language == 'en' else 'text-gray-700' }}">English</a>
                <a href="{{ url_for('set_language', lang_code='zh') }}" class="block px-4 py-2 hover:bg-gray-50 hover:text-red-600 text-sm font-bold {{ 'text-red-600 bg-red-50' if current_language == 'zh' else 'text-gray-700' }}">中文</a>
                <a href="{{ url_for('set_language', lang_code='ms') }}" class="block px-4 py-2 hover:bg-gray-50 hover:text-red-600 text-sm font-bold {{ 'text-red-600 bg-red-50' if current_language == 'ms' else 'text-gray-700' }}">Malay</a>
            </div>
        </div>
    </div>

<div class="relative" id="login-container">
    {% if session.get('logged_in') %}
        <!-- SHOW LOGOUT BUTTON WHEN LOGGED IN -->
        <a href="{{ url_for('logout') }}"
           class="text-red-600 font-bold text-xl flex items-center gap-2 hover:opacity-80">
            <i data-lucide="log-out" class="w-6 h-6"></i>
            {{ _('Logout') }}
        </a>

    {% else %}
        <!-- SHOW LOGIN MENU WHEN NOT LOGGED IN -->
        <button onclick="toggleLoginMenu()" class="text-red-600 font-bold text-xl flex items-center gap-2 hover:opacity-80 focus:outline-none">
            {{ _('Login') }}
            <i data-lucide="user" class="w-6 h-6 fill-current"></i>
            <i data-lucide="chevron-down" class="w-4 h-4 ml-1"></i>
        </button>

        <div id="login-dropdown"
             class="hidden absolute right-0 top-full mt-2 w-56 bg-white shadow-xl border border-gray-200 rounded-xl overflow-hidden z-50">

            <a href="/login" class="flex items-center gap-3 px-5 py-4 hover:bg-red-50 group border-b border-gray-100">
                <div class="bg-red-100 p-2 rounded-full group-hover:bg-red-200">
                    <i data-lucide="user" class="w-4 h-4 text-red-600"></i>
                </div>
                <div>
                    <span class="block text-sm font-bold text-gray-800 group-hover:text-red-600">Personal Login</span>
                    <span class="block text-xs text-gray-500">Internet Banking</span>
                </div>
            </a>

            <a href="/login/business" class="flex items-center gap-3 px-5 py-4 hover:bg-red-50 group">
                <div class="bg-blue-100 p-2 rounded-full group-hover:bg-blue-200">
                    <i data-lucide="briefcase" class="w-4 h-4 text-blue-600"></i>
                </div>
                <div>
                    <span class="block text-sm font-bold text-gray-800 group-hover:text-red-600">Business Login</span>
                    <span class="block text-xs text-gray-500">Velocity @ OCBC</span>
                </div>
            </a>
        </div>
    {% endif %}
</div>
        </div>
    </header>

    <section class="bg-[#F2EEEE] pt-20 pb-48 px-4 flex flex-col items-center relative">

        <div class="w-full max-w-3xl relative z-30 mb-12">
            <div id="suggestions-box" class="hidden absolute top-full mt-4 w-full bg-white rounded-xl shadow-xl border border-gray-100 overflow-hidden z-50">                <div id="suggestions-title" class="bg-gray-50 px-4 py-2 text-xs font-bold text-gray-500 uppercase tracking-wide"></div>
                <div id="suggestions-list"></div>
            </div>

            <div class="relative group">
                <input
                    type="text"
                    id="smart-input"
                    placeholder="{{ _('Need help? Ask me anything.') }}"
                    class="w-full py-5 px-8 rounded-full text-lg shadow-sm border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 text-gray-600 placeholder-gray-400 font-inter"
                />
                <i data-lucide="mic" class="absolute right-6 top-1/2 transform -translate-y-1/2 text-gray-800 cursor-pointer"></i>
            </div>
        </div>

        <div class="bg-[#545252] rounded-[20px] p-10 w-full max-w-5xl relative z-20 shadow-2xl -mb-32">
            <h2 class="text-white text-3xl font-bold mb-8 text-center font-inter">{{ _('Popular Services') }}</h2>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white rounded-2xl p-6 flex flex-col gap-4 hover:scale-105 transition-transform cursor-pointer border border-[#EFEFEF]">
                    <div class="bg-[#F8F4F4] w-12 h-12 rounded-xl flex items-center justify-center">
                         <i data-lucide="wallet" class="text-red-600"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-red-600 font-inter text-sm">{{ _('Open Account') }}</h3>
                        <p class="text-gray-400 text-xs mt-1 font-inter">{{ _('Start your banking journey with us') }}</p>
                    </div>
                </div>

                <div class="bg-white rounded-2xl p-6 flex flex-col gap-4 hover:scale-105 transition-transform cursor-pointer border border-[#EFEFEF]">
                    <div class="bg-[#F8F4F4] w-12 h-12 rounded-xl flex items-center justify-center">
                         <i data-lucide="send" class="text-blue-600"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-blue-600 font-inter text-sm">{{ _('Transfer Funds') }}</h3>
                        <p class="text-gray-400 text-xs mt-1 font-inter">{{ _('Quick and Secure Transfer') }}</p>
                    </div>
                </div>

                <div class="bg-white rounded-2xl p-6 flex flex-col gap-4 hover:scale-105 transition-transform cursor-pointer border border-[#EFEFEF]">
                    <div class="bg-[#F8F4F4] w-12 h-12 rounded-xl flex items-center justify-center">
                         <i data-lucide="trending-up" class="text-orange-500"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-orange-500 font-inter text-sm">{{ _('Investments') }}</h3>
                        <p class="text-gray-400 text-xs mt-1 font-inter">{{ _('Explore Investment Opportunities') }}</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="h-48 bg-white"></div>

    <section class="bg-white py-20 max-w-7xl mx-auto px-4 md:px-12">
        <div class="flex flex-col md:flex-row items-center gap-12">
            <div class="flex-1">
                <h2 class="text-3xl font-bold text-[#363B40] mb-4 leading-snug">{{ _('Purpose is about lifting others.') }}</h2>
                <p class="text-lg text-[#363B40] mb-8 font-light leading-relaxed">
                    {{ _('As One Group, OCBC enables aspirations all across ASEAN and Greater China.') }}
                </p>
                <button class="text-[#005EFD] border-2 border-[#005EFD] px-6 py-2 rounded font-semibold hover:bg-blue-50 transition">
                    {{ _('Find out more') }}
                </button>
            </div>
            <div class="flex-1">
                <img src="/static/pic1.jpg" alt="OCBC Building" class="rounded-[40px] w-full shadow-lg">
            </div>
        </div>
    </section>

    <section class="bg-white py-20 max-w-7xl mx-auto px-4 md:px-12 mb-20">
        <div class="flex flex-col md:flex-row-reverse items-center gap-12">
            <div class="flex-1">
                <h2 class="text-3xl font-bold text-[#363B40] mb-4 leading-snug">{{ _('OCBC - your partner for Johor-Singapore Special Economic Zone') }}</h2>
                <p class="text-lg text-[#363B40] mb-8 font-light leading-relaxed">
                    {{ _('Grow your business beyond borders – backed by expert advisory from our dedicated teams.') }}
                </p>
                <button class="text-[#005EFD] border-2 border-[#005EFD] px-6 py-2 rounded font-semibold hover:bg-blue-50 transition">
                    {{ _('Find out more') }}
                </button>
            </div>
            <div class="flex-1">
                <img src="/static/pic2.jpg" alt="City View" class="rounded-tl-[80px] rounded-br-[80px] rounded-tr-[20px] rounded-bl-[20px] w-full shadow-lg">
            </div>
        </div>
    </section>

    <script>
        // Initialize Icons on load
        lucide.createIcons();

        // ==========================================
        // 1. LOGIN DROPDOWN LOGIC (Keep existing)
        // ==========================================
        function toggleLoginMenu() {
            const menu = document.getElementById('login-dropdown');
            menu.classList.toggle('hidden');
        }

        window.addEventListener('click', function(e) {
            const container = document.getElementById('login-container');
            const menu = document.getElementById('login-dropdown');
            if (!container.contains(e.target)) {
                menu.classList.add('hidden');
            }
        });

        // ==========================================
        // 2. AI SMART INPUT LOGIC (New)
        // ==========================================
        const searchInput = document.getElementById('smart-input');
        const suggestionsBox = document.getElementById('suggestions-box');
        const suggestionsList = document.getElementById('suggestions-list');
        const suggestionsTitle = document.getElementById('suggestions-title');

        let debounceTimer;

        // A. Listen for typing
        searchInput.addEventListener('input', function(e) {
            const query = e.target.value.trim();

            // Clear previous timer (Prevents sending request on every keystroke)
            clearTimeout(debounceTimer);

            // Hide if empty
            if (query.length === 0) {
                suggestionsBox.classList.add('hidden');
                return;
            }

            // Show "Thinking..." state immediately
            suggestionsBox.classList.remove('hidden');
            suggestionsTitle.textContent = "Processing...";
            suggestionsList.innerHTML = '<div class="p-4 text-gray-400 text-xs animate-pulse">Asking OCBC AI...</div>';

            // Wait 400ms after user stops typing, then send to Python
            debounceTimer = setTimeout(() => {
                fetchSuggestions(query);
            }, 400);
        });

        // B. Send to Python Backend
        async function fetchSuggestions(query) {
            try {
                const response = await fetch('/api/navigate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: query })
                });

                const data = await response.json();
                renderSuggestions(data.suggestions);

            } catch (error) {
                console.error('Error:', error);
                suggestionsList.innerHTML = '<div class="p-4 text-red-500 text-xs">Connection error. Please try again.</div>';
            }
        }

        // C. Draw the results on screen
        function renderSuggestions(items) {
            suggestionsList.innerHTML = ''; // Clear old results

            if (!items || items.length === 0) {
                suggestionsTitle.textContent = "No Results";
                suggestionsList.innerHTML = '<div class="p-4 text-gray-400 text-sm">We couldn\'t find a page matching that. Try "Login" or "Cards".</div>';
                return;
            }

            suggestionsTitle.textContent = "Recommended Actions";

            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'flex items-center gap-4 p-4 hover:bg-red-50 cursor-pointer border-b border-gray-100 transition-colors group';

                // We inject the Lucide icon name into the HTML
                div.innerHTML = `
                    <div class="bg-gray-100 text-gray-600 p-2 rounded-lg group-hover:bg-red-100 group-hover:text-red-600 transition-colors">
                        <i data-lucide="${item.icon || 'arrow-right'}" class="w-5 h-5"></i>
                    </div>
                    <div>
                        <div class="font-bold text-gray-800 text-sm group-hover:text-red-700">${item.label}</div>
                        <div class="text-xs text-gray-400 group-hover:text-red-400">${item.desc || 'Go to page'}</div>
                    </div>
                `;

                // Navigate when clicked
                div.onclick = () => {
                    window.location.href = item.url;
                };

                suggestionsList.appendChild(div);
            });

            // CRITICAL: Re-run Lucide to render the new icons we just added
            lucide.createIcons();
        }

        // D. Close suggestions if clicking outside
        document.addEventListener('click', function(e) {
            if (!searchInput.contains(e.target) && !suggestionsBox.contains(e.target)) {
                suggestionsBox.classList.add('hidden');
            }
        });
    </script>
</body>
</html>